<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klinik Fisioterapi Klinik Patria</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        :root {
            --primary-blue: #007BFF;
            --primary-blue-dark: #0056b3;
            --text-dark: #212529;
            --text-muted: #6c757d;
            --light-gray-bg: #f8f9fa;
            --white: #ffffff;
            --border-color: #dee2e6;
            --dark-bg: #1a202c;
            --success-green: #28a745;
            --success-green-dark: #218838;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; scroll-padding-top: 80px; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--white);
            color: var(--text-dark); 
            line-height: 1.7;
        }
        .navbar {
            background: var(--white);
            transition: all 0.3s ease;
            padding: 1rem 0;
        }
        .navbar.navbar-scrolled {
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        .navbar-brand { font-family: 'Poppins', sans-serif; font-weight: 700; color: var(--primary-blue); }
        .navbar-brand img { width: 100px; height: auto; margin-right: 0; }
        .nav-link { font-weight: 600; color: var(--text-muted) !important; transition: color 0.3s ease, transform 0.2s ease; padding: 0.5rem 1rem !important; }
        .nav-link:hover, .nav-link.active { color: var(--primary-blue) !important; transform: translateY(-2px); }
        .navbar .btn-primary { border-radius: 50px; font-weight: 600; padding: 10px 24px; transition: all 0.3s ease; background-color: var(--primary-blue); border-color: var(--primary-blue); }
        .navbar .btn-primary:hover { background-color: var(--primary-blue-dark); border-color: var(--primary-blue-dark); transform: scale(1.05); }
        
        section { padding: 100px 0; overflow-x: hidden; }
        
        #hero { 
            padding: 120px 0; 
            min-height: 100vh; 
            display: flex; 
            align-items: center; 
            background-color: var(--light-gray-bg);
            position: relative;
            overflow: hidden;
        }
        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1;
        }
        #hero .container {
            position: relative;
            z-index: 2;
        }
        #hero h1 { font-family: 'Poppins', sans-serif; font-size: 3.8rem; font-weight: 700; line-height: 1.2; color: var(--text-dark); }
        #hero p { font-size: 1.25rem; opacity: 0.9; max-width: 550px; color: var(--text-muted); }
        .carousel-container {
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
        }
        .carousel-item img {
            width: 100%;
            height: 450px;
            object-fit: cover;
        }

        .bg-light-gray { background-color: var(--light-gray-bg); }
        .container-main { max-width: 900px; margin: 0 auto; }
        .container-auth { max-width: 500px; margin: 0 auto; }
        .card-modern { 
            background: var(--white); 
            border-radius: 16px; 
            padding: 40px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05); 
            border: 1px solid var(--border-color);
            margin-bottom: 20px; 
            transition: all 0.3s ease; 
            height: 100%;
        }
        .card-modern:hover { transform: translateY(-8px); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08); }
        h1, h2, h3, h4, h5 { font-family: 'Poppins', sans-serif; font-weight: 700; }
        h2 { font-size: 2.5rem; color: var(--text-dark); margin-bottom: 24px; }
        h3 { font-size: 1.3rem; font-weight: 600; color: var(--text-dark); margin-bottom: 16px; }
        .text-muted { color: var(--text-muted) !important; font-size: 1rem; }
        .btn-primary-modern { background-color: var(--primary-blue); border: none; color: var(--white); padding: 14px 32px; border-radius: 12px; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2); }
        .btn-primary-modern:hover { transform: translateY(-3px) scale(1.03); box-shadow: 0 6px 25px rgba(0, 123, 255, 0.3); background-color: var(--primary-blue-dark); }
        .btn-secondary-modern { background: #e9ecef; border: none; color: #495057; padding: 14px 32px; border-radius: 12px; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; cursor: pointer; }
        .btn-secondary-modern:hover { background: #ced4da; transform: translateY(-3px); }
        .category-card { border: 2px solid var(--border-color); border-radius: 16px; padding: 32px; cursor: pointer; transition: all 0.3s ease; background-color: var(--white); }
        .category-card:hover { border-color: var(--primary-blue); transform: translateY(-4px); box-shadow: 0 10px 30px rgba(0, 123, 255, 0.1); }
        
        .category-icon {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            margin: 0 auto 24px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 3px solid var(--white);
        }
        .category-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        /* Style baru untuk gambar layanan */
        .service-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 16px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 3px solid var(--white);
        }
        .service-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .service-card { text-align: center; transition: all 0.3s ease; }
        .form-label { font-weight: 600; color: #495057; margin-bottom: 8px; font-size: 0.95rem; }
        .form-control, .form-select { border: 2px solid var(--border-color); border-radius: 10px; padding: 12px 16px; font-size: 1rem; transition: all 0.3s ease; background-color: var(--white); }
        .form-control:focus, .form-select:focus { border-color: var(--primary-blue); box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.15); outline: none; }
        .info-box { background: #e7f3ff; border-left: 4px solid var(--primary-blue); border-radius: 12px; padding: 20px; margin: 24px 0; }
        .info-box p strong { color: var(--primary-blue-dark); }
        
        .modal-content { border-radius: 20px; border: none; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.1); }
        .modal-header { background: var(--primary-blue); color: var(--white); border: none; padding: 24px; }
        .modal-title { font-weight: 600; }
        .modal-body { padding: 32px; }
        .list-group-item { border: none; border-bottom: 1px solid #e9ecef; padding: 16px 0; }
        .list-group-item strong.text-end { max-width: 60%; text-align: right; }
        
        #success-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--light-gray-bg);
            align-items: center; justify-content: center;
            padding: 20px; z-index: 2000;
            display: none; 
        }
        .success-container { 
            background: var(--white);
            color: var(--text-dark);
            border-radius: 24px; 
            padding: 40px; 
            max-width: 550px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }
        .success-icon { width: 70px; height: 70px; background: var(--success-green); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; }
        .success-icon svg { width: 40px; height: 40px; color: var(--white); }
        .ticket-display { border: 2px dashed var(--primary-blue); border-radius: 16px; padding: 24px; margin: 32px 0; }
        .ticket-display p { margin-bottom: 4px; color: var(--text-muted); }
        .ticket-number { font-family: 'Poppins', sans-serif; font-size: 3rem; font-weight: 700; color: var(--primary-blue-dark); letter-spacing: 2px; }
        .ticket-schedule { font-weight: 600; font-size: 1.1rem; color: var(--text-dark); }
        
        .footer-modern { 
            background: var(--dark-bg); 
            color: #a0aec0; 
            padding: 60px 0 30px 0; 
            font-size: 0.95rem; 
        }
        .footer-modern h5 { color: var(--white); margin-bottom: 1rem; font-weight: 600; }
        .footer-modern ul { list-style: none; padding: 0; }
        .footer-modern a { color: #a0aec0; text-decoration: none; transition: color 0.3s ease; }
        .footer-modern a:hover { color: var(--white); }
        .footer-modern .list-unstyled li { margin-bottom: 0.75rem; }
        .footer-modern .social-icons a { color: #a0aec0; font-size: 1.25rem; margin-right: 1rem; transition: color 0.3s ease, transform 0.3s ease; }
        .footer-modern .social-icons a:hover { color: var(--white); transform: scale(1.1); }
        .footer-modern .border-top { border-color: rgba(255,255,255,0.1) !important; }

        .hidden { display: none !important; }
        
        .reveal {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        @media (max-width: 991.98px) { 
            #hero { 
                text-align: center; 
                padding-top: 150px; 
                padding-bottom: 80px;
                min-height: auto;
            } 
            #hero h1 { 
                font-size: 2.8rem;
            }
            #hero p { 
                margin-left: auto; 
                margin-right: auto;
                font-size: 1.1rem;
            }
            .hero-carousel-column {
                margin-top: 40px;
            }
        }
        @media (max-width: 768px) {
            section { padding: 60px 15px; }
            .card-modern { padding: 24px; border-radius: 16px; }
            h2 { font-size: 2rem; }
            .success-container { padding: 30px; }
            .ticket-number { font-size: 2.5rem; }
        }
    </style>
</head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="index.html">
                <img src="https://agent48.site/assets/mac/logoklinik.png" alt="Logo Klinik">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link" href="#hero">Beranda</a></li>
                    <li class="nav-item"><a class="nav-link" href="#about">Tentang</a></li>
                    <li class="nav-item"><a class="nav-link" href="#services">Layanan</a></li>
                    <li class="nav-item"><a class="nav-link" href="#pendaftaran">Pendaftaran</a></li>
                </ul>
                <div id="auth-section-guest" class="d-lg-inline-block">
                    <a href="#" id="btn-login-nav" class="btn btn-primary">Login</a>
                </div>
            </div>
        </div>
    </nav>
    
    <div id="main-content">
        <main>
            <div id="landing-page">
                <section id="hero">
                    <div id="particles-js"></div>
                    <div class="container">
                        <div class="row align-items-center g-5">
                            <div class="col-lg-6">
                                <h1 class="reveal">Solusi Fisioterapi Modern & Inklusif</h1>
                                <p class="my-4 reveal" style="transition-delay: 0.2s;">
                                    Kami hadir untuk memberikan layanan rehabilitasi berkualitas tinggi yang dapat diakses oleh semua kalangan, memulihkan gerak dan harapan Anda.
                                </p>
                                <a href="#pendaftaran" class="btn-primary-modern reveal" style="transition-delay: 0.4s; font-size: 1.1rem; padding: 16px 36px;">Daftar Sekarang →</a>
                            </div>
                            <div class="col-lg-6 hero-carousel-column reveal" style="transition-delay: 0.3s;">
                                <div class="carousel-container">
                                    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
                                        <div class="carousel-inner">
                                            <div class="carousel-item active">
                                                <img src="https://agent48.site/assets/mac/foto1.jpg" class="d-block w-100" alt="Fisioterapi modern">
                                            </div>
                                            <div class="carousel-item">
                                                <img src="https://agent48.site/assets/mac/foto2.jpg" class="d-block w-100" alt="Rehabilitasi pasien">
                                            </div>
                                            <div class="carousel-item">
                                                <img src="https://agent48.site/assets/mac/foto3.jpg" class="d-block w-100" alt="Lingkungan klinik yang nyaman">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="about" class="bg-light-gray">
                    <div class="container">
                        <div class="row g-4 justify-content-center">
                            <div class="col-lg-7">
                                <div class="card-modern reveal text-center">
                                    <h2 class="mb-3">Tentang Kami</h2>
                                    <p class="text-muted" style="line-height: 1.8;">
                                        Kami menyediakan layanan rehabilitasi fisioterapi yang inklusif, berkualitas, dan terjangkau. Program ini diprioritaskan bagi kalangan disabilitas dari keluarga prasejahtera. Meski demikian, masyarakat umum tetap dapat mendaftar dan memperoleh layanan sesuai dengan ketersediaan jadwal dan kuota setelah kelompok prioritas terpenuhi.
                                    </p>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="card-modern reveal text-center" style="transition-delay: 0.1s">
                                    <h2 class="mb-3">Jam Operasional</h2>
                                    <div style="font-size: 2.5rem; font-family: 'Poppins', sans-serif; font-weight: 700; color: var(--primary-blue-dark); margin: 8px 0;">07:00 - 20:00</div>
                                    <p class="text-muted mb-0">Senin - Minggu (Buka Setiap Hari)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section id="services">
                    <div class="container">
                        <h2 class="text-center mb-5 reveal">Layanan Unggulan Kami</h2>
                        <div class="row g-4 justify-content-center">
                            <div class="col-md-3">
                                <div class="card-modern service-card reveal" style="transition-delay: 0.1s;">
                                    <div class="service-icon"><img src="https://agent48.site/assets/mac/Autism.png" alt="Autism spectrum Disoder"></div>
                                    <h3 class="mt-3">Autism Spectrum Disorder</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-modern service-card reveal" style="transition-delay: 0.2s;">
                                    <div class="service-icon"><img src="https://agent48.site/assets/mac/Cerebral.png" alt="Cerebral Palsy"></div>
                                    <h3 class="mt-3">Cerebral Palsy</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-modern service-card reveal" style="transition-delay: 0.3s;">
                                    <div class="service-icon"><img src="https://agent48.site/assets/mac/down.png" alt="Down Syndrome"></div>
                                    <h3 class="mt-3">Down Syndrome</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-modern service-card reveal" style="transition-delay: 0.4s;">
                                    <div class="service-icon"><img src="https://agent48.site/assets/mac/Faktor.png" alt="Faktor Cedera Anak-Dewasa"></div>
                                    <h3 class="mt-3">Faktor Cedera Anak-Dewasa</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-modern service-card reveal" style="transition-delay: 0.5s;">
                                    <div class="service-icon"><img src="https://agent48.site/assets/mac/Gangguan.png" alt="Gangguan Postural"></div>
                                    <h3 class="mt-3">Gangguan Postural</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-modern service-card reveal" style="transition-delay: 0.6s;">
                                    <div class="service-icon"><img src="https://agent48.site/assets/mac/Gross.png" alt="Gross Delay Development"></div>
                                    <h3 class="mt-3">Gross Delay Development</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-modern service-card reveal" style="transition-delay: 0.7s;">
                                    <div class="service-icon"><img src="https://agent48.site/assets/mac/Input.png" alt="Gangguan Input Sensorik dan Motorik"></div>
                                    <h3 class="mt-3">Gangguan Input Sensorik & Motorik</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-modern service-card reveal" style="transition-delay: 0.8s;">
                                    <div class="service-icon"><img src="https://agent48.site/assets/mac/Layanan.png" alt="Layanan Pasca Operasi"></div>
                                    <h3 class="mt-3">Layanan Pasca Operasi</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="pendaftaran" class="bg-light-gray">
                    <div class="container-main">
                        <div class="card-modern reveal">
                            <h2 class="text-center mb-4">Pilih Kategori Pendaftaran</h2>
                            <p class="text-muted text-center mt-n3 mb-5">Pilih salah satu kategori di bawah ini untuk memulai proses pendaftaran Anda.</p>
                            
                            <div class="row g-4">
                                <div class="col-lg-4 col-md-6">
                                    <div class="category-card d-flex flex-column text-center h-100">
                                        <div class="category-icon">
                                            <img src="https://images.unsplash.com/photo-1582213782179-e0d53f98f2ca?q=80&w=400&auto=format&fit=crop" alt="Dukungan Komunitas">
                                        </div>
                                        <h3 class="mt-3">Disabilitas<br>(Dengan SKTM)</h3>
                                        <button class="btn-primary-modern w-100 mt-auto register-btn-landing">Daftar Kategori Ini</button>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-6">
                                    <div class="category-card d-flex flex-column text-center h-100">
                                        <div class="category-icon">
                                           <img src="https://images.unsplash.com/photo-1599058917212-d750089bc07e?q=80&w=400&auto=format&fit=crop" alt="Fisioterapi">
                                        </div>
                                        <h3 class="mt-3">Disabilitas<br>(Non-SKTM)</h3>
                                        <button class="btn-primary-modern w-100 mt-auto register-btn-landing">Daftar Kategori Ini</button>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-12">
                                    <div class="category-card d-flex flex-column text-center h-100">
                                        <div class="category-icon">
                                           <img src="https://images.unsplash.com/photo-1576091160550-2173dba999ef?q=80&w=400&auto=format&fit=crop" alt="Layanan Kesehatan Umum">
                                        </div>
                                        <h3 class="mt-3">Masyarakat<br>Umum</h3>
                                        <button class="btn-primary-modern w-100 mt-auto register-btn-landing">Daftar Kategori Ini</button>
                                    </div>
                                </div>
                            </div>
                            </div>
                    </div>
                </section>
            </div>

            <section id="login-page" class="hidden bg-light-gray" style="min-height: 100vh;">
                <div class="container-auth">
                    <div class="card-modern">
                        <h2 class="text-center">Login</h2>
                        <p class="text-muted text-center mb-4">Silakan masuk untuk melanjutkan pendaftaran.</p>
                        <form id="login-form">
                            <div class="mb-3">
                                <label for="login-email" class="form-label">Email</label>
                                <input type="email" id="login-email" class="form-control" required>
                            </div>
                            <div class="mb-4">
                                <label for="login-password" class="form-label">Password</label>
                                <input type="password" id="login-password" class="form-control" required>
                            </div>
                            <button type="submit" class="btn-primary-modern w-100">Login</button>
                        </form>
                        <p class="text-center text-muted mt-4 mb-0">
                            Belum punya akun? <a href="#" id="go-to-register">Daftar di sini</a> <br>
                            <a href="login.html" id="go-to-register">Login Admin</a>
                        </p>
                    </div>
                </div>
            </section>

            <section id="register-page" class="hidden bg-light-gray" style="min-height: 100vh;">
                <div class="container-auth">
                    <div class="card-modern">
                        <h2 class="text-center">Buat Akun Baru</h2>
                        <p class="text-muted text-center mb-4">Lengkapi data di bawah untuk membuat akun.</p>
                        <form id="register-form">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label for="register-name" class="form-label">Nama Lengkap</label>
                                    <input type="text" id="register-name" class="form-control" required>
                                </div>
                                <div class="col-12">
                                    <label for="register-email" class="form-label">Email</label>
                                    <input type="email" id="register-email" class="form-control" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="register-phone" class="form-label">Nomor HP</label>
                                    <input type="tel" id="register-phone" class="form-control" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="register-dob" class="form-label">Tanggal Lahir</label>
                                    <input type="date" id="register-dob" class="form-control" required>
                                </div>
                                <div class="col-12">
                                    <label for="register-password" class="form-label">Password</label>
                                    <input type="password" id="register-password" class="form-control" required minlength="6">
                                </div>
                            </div>
                            <button type="submit" class="btn-primary-modern w-100 mt-4">Daftar</button>
                        </form>
                         <p class="text-center text-muted mt-4 mb-0">
                            Sudah punya akun? <a href="#" id="go-to-login">Login di sini</a>
                        </p>
                    </div>
                </div>
            </section>

            <section id="user-dashboard" class="hidden bg-light-gray" style="min-height: 100vh; display: flex; align-items: center;">
                <div class="container-main">
                    <div class="card-modern text-center">
                        <h2 class="mb-3">Selamat Datang, <span id="user-name-display"></span>!</h2>
                        <p class="text-muted mt-n2 mb-4">Silakan pilih kategori pendaftaran fisioterapi Anda.</p>
                        
                        <div class="d-grid gap-2 col-6 mx-auto mb-5">
                            <button id="btn-logout-dashboard" class="btn btn-outline-danger">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </button>
                        </div>

                        <div class="row g-4">
                            <div class="col-lg-4 col-md-6">
                                <div class="category-card d-flex flex-column text-center h-100">
                                    <div class="category-icon">
                                        <img src="https://images.unsplash.com/photo-1582213782179-e0d53f98f2ca?q=80&w=400&auto=format&fit=crop" alt="Dukungan Komunitas">
                                    </div>
                                    <h3 class="mt-3">Disabilitas<br>(Dengan SKTM)</h3>
                                    <button class="btn-primary-modern w-100 mt-auto register-btn" data-category="disabilitas-sktm" data-price="30000">Pilih Kategori Ini</button>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-6">
                                <div class="category-card d-flex flex-column text-center h-100">
                                    <div class="category-icon">
                                        <img src="https://images.unsplash.com/photo-1599058917212-d750089bc07e?q=80&w=400&auto=format&fit=crop" alt="Fisioterapi">
                                    </div>
                                    <h3 class="mt-3">Disabilitas<br>(Non-SKTM)</h3>
                                    <button class="btn-primary-modern w-100 mt-auto register-btn" data-category="disabilitas-non-sktm" data-price="80000">Pilih Kategori Ini</button>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-12">
                                <div class="category-card d-flex flex-column text-center h-100">
                                    <div class="category-icon">
                                        <img src="https://images.unsplash.com/photo-1576091160550-2173dba999ef?q=80&w=400&auto=format&fit=crop" alt="Layanan Kesehatan Umum">
                                    </div>
                                    <h3 class="mt-3">Masyarakat<br>Umum</h3>
                                    <button class="btn-primary-modern w-100 mt-auto register-btn" data-category="umum" data-price="80000">Pilih Kategori Ini</button>
                                </div>
                            </div>
                        </div>
                         </div>
                </div>
            </section>
            
            <section id="registration-form" class="hidden bg-light-gray">
                <div class="container-main">
                    <div class="card-modern">
                        <h2 class="text-center">Formulir Pendaftaran</h2>
                        <p class="text-muted text-center mb-4">Mohon lengkapi data di bawah ini dengan benar.</p>
                        <form id="patient-form" autocomplete="off">
                            <h3>Data Pasien</h3>
                            <div class="row g-3 mb-4">
                                <div class="col-md-6"><label for="full-name" class="form-label">Nama Lengkap Pasien</label><input type="text" name="fullName" id="full-name" required class="form-control" placeholder="Masukkan nama lengkap"></div>
                                <div class="col-md-6"><label for="dob" class="form-label">Tanggal Lahir</label><input type="date" name="dob" id="dob" required class="form-control"></div>
                                <div class="col-md-6"><label for="gender" class="form-label">Jenis Kelamin</label><select name="gender" id="gender" required class="form-select"><option value="">Pilih...</option><option value="Laki-laki">Laki-laki</option><option value="Perempuan">Perempuan</option></select></div>
                                <div class="col-md-6"><label for="phone" class="form-label">Nomor HP/WA</label><input type="tel" name="phone" id="phone" required class="form-control" placeholder="08xxxxxxxxxx"></div>
                                <div class="col-12"><label for="address" class="form-label">Alamat Lengkap</label><textarea name="address" id="address" rows="3" required class="form-control" placeholder="Masukkan alamat lengkap"></textarea></div>
                                <div class="col-md-6"><label for="guardian-name" class="form-label">Nama Wali/Pendamping</label><input type="text" name="guardianName" id="guardian-name" required class="form-control" placeholder="Nama lengkap wali"></div>
                                <div class="col-md-6">
                                    <label for="disability-type" class="form-label">Jenis Disabilitas / Layanan</label>
                                    <select name="disabilityType" id="disability-type" class="form-select">
                                        <option value="">Pilih Layanan...</option>
                                        <option value="Autism Spectrum Disorder">Autism Spectrum Disorder</option>
                                        <option value="Cerebral Palsy">Cerebral Palsy</option>
                                        <option value="Down Syndrome">Down Syndrome</option>
                                        <option value="Faktor Cedera Anak-Dewasa">Faktor Cedera Anak-Dewasa</option>
                                        <option value="Gangguan Postural">Gangguan Postural</option>
                                        <option value="Gross Delay Development">Gross Delay Development</option>
                                        <option value="Gangguan Input Sensorik & Motorik">Gangguan Input Sensorik & Motorik</option>
                                        <option value="Layanan Pasca Operasi">Layanan Pasca Operasi</option>
                                    </select>
                                </div>
                                <div class="col-12"><label for="complaint" class="form-label">Keluhan Utama</label><textarea name="complaint" id="complaint" rows="3" required class="form-control" placeholder="Jelaskan keluhan yang Anda rasakan..."></textarea></div>
                                <div id="file-upload-section-sktm" class="col-12 hidden"><label for="sktm-file" class="form-label">Upload SKTM / KKS</label><input type="file" id="sktm-file" class="form-control" accept="image/*,.pdf"><p id="sktm-file-name-display" class="form-text mt-1"></p></div>
                            </div>
                            
                            <h3>Jadwal Kunjungan</h3>
                            <div class="row g-3 mb-4">
                                <div class="col-md-6"><label for="visit-date" class="form-label">Pilih Tanggal</label><input type="date" name="date" id="visit-date" class="form-control" required></div>
                                <div class="col-md-6"><label for="visit-time" class="form-label">Pilih Jam</label><select name="time" id="visit-time" class="form-select" required></select></div>
                            </div>

                            <h3>Pembayaran</h3>
                            <div class="info-box">
                                <p class="mb-2"><strong>Rekening Pembayaran:</strong> BCA: 123-456-7890 a.n. Klinik Patria</p>
                                <p class="mb-0" style="font-size: 1.25rem; font-weight: 700; color: var(--primary-blue-dark);" id="form-total-cost">Total: Rp 0</p>
                            </div>
                            <div class="mb-4"><label for="payment-proof-file" class="form-label">Upload Bukti Pembayaran</label><input type="file" id="payment-proof-file" class="form-control" required accept="image/*,.pdf"><p id="payment-file-name-display" class="form-text mt-1"></p></div>
                            
                            <div class="d-flex justify-content-between gap-3 mt-5"><button type="button" id="btn-back-to-dashboard" class="btn-secondary-modern">← Kembali</button><button type="submit" class="btn-primary-modern">Lanjut ke Konfirmasi →</button></div>
                        </form>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="footer-modern">
            <div class="container text-center text-md-start">
                <div class="row gy-4">
                    <div class="col-lg-4 col-md-12"><h5 class="fw-bold">Klinik Patria</h5><p>Solusi Fisioterapi Modern & Inklusif untuk memulihkan gerak dan harapan Anda.</p></div>
                    <div class="col-lg-2 col-md-4"><h5 class="fw-bold">Navigasi</h5><ul class="list-unstyled"><li><a href="#hero">Beranda</a></li><li><a href="#about">Tentang</a></li><li><a href="#services">Layanan</a></li><li><a href="#pendaftaran">Daftar</a></li></ul></div>
                    <div class="col-lg-3 col-md-4"><h5 class="fw-bold">Kontak</h5><ul class="list-unstyled"><li><i class="fas fa-map-marker-alt me-2"></i>Jl. Sehat Selalu No. 123</li><li><i class="fas fa-phone me-2"></i>(021) 123-4567</li><li><i class="fas fa-envelope me-2"></i>kontak@klinikpatria.com</li></ul></div>
                    <div class="col-lg-3 col-md-4"><h5 class="fw-bold">Ikuti Kami</h5><div class="social-icons"><a href="#"><i class="fab fa-facebook"></i></a><a href="#"><i class="fab fa-instagram"></i></a><a href="#"><i class="fab fa-whatsapp"></i></a></div></div>
                </div>
                <div class="text-center mt-5 border-top pt-4"><p>&copy; 2025 Klinik Fisioterapi Klinik Patria. All Rights Reserved.</p></div>
            </div>
        </footer>
    </div>
    
    <section id="success-page">
        <div class="success-container text-center">
            <div class="success-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg></div>
            <h2>Pendaftaran Berhasil!</h2>
            <p class="text-muted mb-4">Terima kasih telah mendaftar. Simpan detail tiket antrian Anda.</p>
            <div class="ticket-display">
                <p>Nomor Antrian Anda</p>
                <div id="queue-number" class="ticket-number"></div>
                <div id="queue-schedule" class="ticket-schedule"></div>
            </div>
            <div class="text-start text-muted small my-4">
                <p>Terima kasih telah mendaftar di layanan fisioterapi Klinik Patria. Silakan bawa atau tunjukkan tiket pendaftaran ini saat berkunjung ke Klinik Patria pada jadwal yang telah Anda pilih.</p>
                <p class="mb-0">Apabila terdapat perubahan jadwal atau informasi tambahan, tim kami akan menghubungi Anda melalui WhatsApp atau email yang terdaftar.</p>
            </div>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <button id="btn-download-ticket" class="btn-secondary-modern">Unduh Tiket</button>
                <button id="btn-back-to-home" class="btn-primary-modern">Halaman Awal</button>
            </div>
        </div>
    </section>

    <div class="modal fade" id="confirmation-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Konfirmasi Pendaftaran</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button></div>
                <div class="modal-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between"><span>Nama Pasien:</span><strong id="confirm-name"></strong></li>
                        <li class="list-group-item d-flex justify-content-between"><span>No. HP/WA:</span><strong id="confirm-phone"></strong></li>
                        <li class="list-group-item d-flex justify-content-between"><span>Jenis Disabilitas:</span><strong id="confirm-disability"></strong></li>
                        <li class="list-group-item d-flex justify-content-between"><span>Keluhan:</span><strong id="confirm-complaint" class="text-end"></strong></li>
                        <li class="list-group-item d-flex justify-content-between"><span>Jadwal:</span><strong id="confirm-schedule" class="text-end"></strong></li>
                        <li class="list-group-item d-flex justify-content-between"><span>Kategori:</span><strong id="confirm-category"></strong></li>
                        <li class="list-group-item d-flex justify-content-between align-items-center" style="border-bottom: none;"><strong style="color: var(--primary-blue-dark);">Total Biaya:</strong><strong id="confirm-cost" style="color: var(--primary-blue-dark); font-size: 1.25rem;">Rp 0</strong></li>
                    </ul>
                </div>
                <div class="modal-footer" style="border: none; padding: 24px;">
                    <button type="button" class="btn-secondary-modern" data-bs-dismiss="modal">Batal</button>
                    <button type="button" id="btn-submit-final" class="btn-primary-modern">Konfirmasi & Daftar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-database-compat.js"></script>
    
    <script>
    // ▼▼▼ SCRIPT TAMPILAN (TIDAK BERUBAH) ▼▼▼
    particlesJS("particles-js", {
        "particles": { "number": { "value": 80, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#007bff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.5, "random": false }, "size": { "value": 3, "random": true }, "line_linked": { "enable": true, "distance": 150, "color": "#007bff", "opacity": 0.4, "width": 1 }, "move": { "enable": true, "speed": 2, "direction": "none", "out_mode": "out" } }, "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": true, "mode": "repulse" }, "onclick": { "enable": true, "mode": "push" }, "resize": true }, "modes": { "repulse": { "distance": 100, "duration": 0.4 }, "push": { "particles_nb": 4 } } }, "retina_detect": true
    });
    window.addEventListener('scroll', () => {
        const navbar = document.querySelector('.navbar');
        if (window.scrollY > 50) { navbar.classList.add('navbar-scrolled'); } else { navbar.classList.remove('navbar-scrolled'); }
    });
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); }
        });
    }, { threshold: 0.1 });
    document.querySelectorAll('.reveal').forEach(el => { observer.observe(el); });
    </script>

    <script>
    // ▼▼▼ LOGIKA UTAMA APLIKASI ▼▼▼
    const firebaseConfig = {
        apiKey: "AIzaSyB-zS7qBYN9riG58CxcdoTew_DH_wHrFpA",
        authDomain: "projek-link.firebaseapp.com",
        databaseURL: "https://projek-link-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "projek-link",
        storageBucket: "projek-link.appspot.com",
        messagingSenderId: "1034379064850",
        appId: "1:1034379064850:web:ddf6cab5c15eeca0a40acb",
        measurementId: "G-8SFSX5F32J"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database(); 
    
    document.addEventListener('DOMContentLoaded', () => {
        sessionStorage.removeItem('registrationFormData');

        let registrationData = {};
        let loggedInUser = null; 
        
        const mainNavbar = document.querySelector('.navbar');
        const mainContent = document.getElementById('main-content');
        const sections = {
            landing: document.getElementById('landing-page'),
            login: document.getElementById('login-page'),
            register: document.getElementById('register-page'),
            dashboard: document.getElementById('user-dashboard'),
            form: document.getElementById('registration-form'),
            success: document.getElementById('success-page')
        };
        const confirmationModal = new bootstrap.Modal(document.getElementById('confirmation-modal'));

        const authGuestNav = document.getElementById('auth-section-guest');

        function showSection(sectionId) {
            Object.values(sections).forEach(section => section.classList.add('hidden'));

            const sectionsWithoutNav = ['dashboard', 'form', 'success'];
            if (sectionsWithoutNav.includes(sectionId)) {
                mainNavbar.classList.add('hidden');
            } else {
                mainNavbar.classList.remove('hidden');
            }

            if (sectionId === 'success') {
                mainContent.style.display = 'none';
                sections.success.classList.remove('hidden');
                sections.success.style.display = 'flex';
            } else {
                mainContent.style.display = 'block';
                if (sections[sectionId]) {
                    sections[sectionId].classList.remove('hidden');
                }
            }
            window.scrollTo(0, 0);
        }
        
        function updateAuthStateUI() {
            if (loggedInUser) {
                document.getElementById('user-name-display').textContent = loggedInUser.name;
                authGuestNav.classList.add('d-none');
            } else {
                authGuestNav.classList.remove('d-none');
            }
        }
        
        function checkLoginStatus() {
            const savedUser = sessionStorage.getItem('loggedInUser');
            if (savedUser) {
                loggedInUser = JSON.parse(savedUser);
            }
            updateAuthStateUI();
        }

        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;
            const dob = document.getElementById('register-dob').value;
            const password = document.getElementById('register-password').value;
            
            const usersRef = db.ref('users');
            usersRef.orderByChild('email').equalTo(email).once('value', snapshot => {
                if (snapshot.exists()) {
                    alert('Error: Email sudah terdaftar. Silakan gunakan email lain.');
                } else {
                    const newUserData = { name, email, phone, dob, password };
                    usersRef.push(newUserData);
                    alert('Pendaftaran berhasil! Silakan login untuk melanjutkan.');
                    document.getElementById('login-email').value = email;
                    showSection('login');
                }
            }).catch(error => {
                alert(`Error: ${error.message}`);
            });
        });

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            const usersRef = db.ref('users');
            usersRef.orderByChild('email').equalTo(email).once('value', snapshot => {
                if (snapshot.exists()) {
                    let userFound = false;
                    snapshot.forEach(childSnapshot => {
                        const userData = childSnapshot.val();
                        if (userData.password === password) {
                            loggedInUser = userData;
                            sessionStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
                            userFound = true;
                        }
                    });

                    if (userFound) {
                        updateAuthStateUI();
                        showSection('dashboard');
                    } else {
                        alert('Error: Password salah.');
                    }
                } else {
                    alert('Error: Email tidak ditemukan.');
                }
            }).catch(error => {
                alert(`Error: ${error.message}`);
            });
        });

        function performLogout() {
            document.getElementById('user-name-display').textContent = '';
            
            loggedInUser = null;
            sessionStorage.removeItem('loggedInUser');
            sessionStorage.removeItem('registrationFormData');
            updateAuthStateUI();
            showSection('landing');
        }

        document.getElementById('btn-logout-dashboard').addEventListener('click', performLogout);

        document.getElementById('go-to-register').addEventListener('click', (e) => { e.preventDefault(); showSection('register'); });
        document.getElementById('go-to-login').addEventListener('click', (e) => { e.preventDefault(); showSection('login'); });
        document.getElementById('btn-login-nav').addEventListener('click', (e) => { e.preventDefault(); showSection('login'); });

        document.querySelectorAll('.register-btn-landing').forEach(button => {
            button.addEventListener('click', () => {
                if (loggedInUser) {
                    showSection('dashboard');
                } else {
                    showSection('login');
                }
            });
        });
        
        document.querySelectorAll('.register-btn').forEach(button => {
            button.addEventListener('click', () => {
                document.getElementById('patient-form').reset();
                
                registrationData = {}; 
                registrationData.category = button.dataset.category;
                registrationData.price = button.dataset.price;

                const isKurangMampu = registrationData.category === 'disabilitas-sktm';
                document.getElementById('file-upload-section-sktm').classList.toggle('hidden', !isKurangMampu);
                document.getElementById('sktm-file').required = isKurangMampu;
                
                document.getElementById('form-total-cost').textContent = `Total: Rp ${new Intl.NumberFormat('id-ID').format(registrationData.price)}`;
                
                if(loggedInUser) {
                    document.getElementById('full-name').value = loggedInUser.name;
                    document.getElementById('phone').value = loggedInUser.phone;
                    document.getElementById('dob').value = loggedInUser.dob;
                    document.getElementById('guardian-name').value = loggedInUser.name;
                }
                
                showSection('form');
            });
        });

        document.getElementById('btn-back-to-dashboard').addEventListener('click', () => {
            showSection('dashboard');
        });
        
        function generateTimeSlots() {
            const timeSelect = document.getElementById('visit-time');
            timeSelect.innerHTML = '<option value="">Pilih Jam...</option>';
            const timeSlots = [
                "07:00 - 08:00", "08:00 - 09:00", "09:00 - 10:00",
                "10:00 - 11:00", "11:00 - 12:00", "16:00 - 17:00",
                "17:00 - 18:00", "18:00 - 19:00", "19:00 - 20:00"
            ];
            timeSlots.forEach(slot => {
                const option = new Option(slot, slot);
                timeSelect.add(option);
            });
        }
        generateTimeSlots();
        document.getElementById('visit-date').setAttribute('min', new Date().toISOString().split('T')[0]);

        function setupFileInputListener(inputId, displayId) {
            const fileInput = document.getElementById(inputId); 
            const fileNameDisplay = document.getElementById(displayId);
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    fileNameDisplay.textContent = `✓ File: ${fileInput.files[0].name}`; 
                    fileNameDisplay.style.color = '#28a745'; 
                    fileNameDisplay.style.fontWeight = '600';
                } else { 
                    fileNameDisplay.textContent = ''; 
                }
            });
        }
        setupFileInputListener('sktm-file', 'sktm-file-name-display');
        setupFileInputListener('payment-proof-file', 'payment-file-name-display');

        document.getElementById('patient-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const formProps = Object.fromEntries(formData.entries());
            
            Object.assign(registrationData, formProps);
            registrationData.registeredByEmail = loggedInUser ? loggedInUser.email : 'guest';

            const categoryMap = {
                'disabilitas-sktm': 'Disabilitas (Dengan SKTM)',
                'disabilitas-non-sktm': 'Disabilitas (Non-SKTM)',
                'umum': 'Masyarakat Umum'
            };

            const formatDate = (dateString) => new Date(dateString).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'Asia/Jakarta' });
            document.getElementById('confirm-name').textContent = registrationData.fullName;
            document.getElementById('confirm-phone').textContent = registrationData.phone;
            document.getElementById('confirm-disability').textContent = registrationData.disabilityType || 'Tidak ada';
            document.getElementById('confirm-complaint').textContent = registrationData.complaint;
            document.getElementById('confirm-schedule').textContent = `${formatDate(registrationData.date)}, ${registrationData.time}`;
            document.getElementById('confirm-category').textContent = categoryMap[registrationData.category];
            document.getElementById('confirm-cost').textContent = `Rp ${new Intl.NumberFormat('id-ID').format(registrationData.price)}`;
            confirmationModal.show();
        });
        
        async function uploadFileToGoogleScript(file, patientName, orderId) {
            const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz5NBQubB4EsLEXcOtIka5Cty27Ttp7dVq30WbVpsiTtA_tsjmaS-UwX05p3kdfFam-BA/exec";
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async () => {
                    const base64Data = reader.result.split(',')[1];
                    const url = `${GOOGLE_SCRIPT_URL}?filename=${encodeURIComponent(file.name)}&name=${encodeURIComponent(patientName)}&orderId=${orderId}`;
                    try {
                        const response = await fetch(url, { method: 'POST', body: base64Data, headers: { 'Content-Type': 'text/plain;charset=utf-8' } });
                        if (!response.ok) { throw new Error(`Server merespons dengan status error: ${response.status}`); }
                        const result = await response.json();
                        if (result.status === 'sukses') { resolve(result.fileUrl); } else { console.error("Google Script Error:", result); reject(new Error('Skrip server gagal memproses file: ' + (result.message || 'Error tidak diketahui'))); }
                    } catch (error) { console.error("Fetch/Network Error:", error); reject(new Error('Masalah jaringan saat mengunggah file. Pastikan koneksi internet stabil.')); }
                };
                reader.onerror = error => { console.error("FileReader Error:", error); reject(new Error('Gagal membaca file dari perangkat Anda.')); };
            });
        }

        document.getElementById('btn-submit-final').addEventListener('click', async () => {
            const submitButton = document.getElementById('btn-submit-final');
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Memproses...';
            try {
                const orderId = `REG-${Date.now()}`;
                const sktmFile = document.getElementById('sktm-file').files[0];
                const paymentFile = document.getElementById('payment-proof-file').files[0];
                if (sktmFile && registrationData.category === 'disabilitas-sktm') {
                    submitButton.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Mengunggah SKTM...';
                    registrationData.sktmFileUrl = await uploadFileToGoogleScript(sktmFile, registrationData.fullName, orderId + "_SKTM");
                }
                if (paymentFile) {
                    submitButton.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Mengunggah Bukti Bayar...';
                    registrationData.paymentProofFileUrl = await uploadFileToGoogleScript(paymentFile, registrationData.fullName, orderId + "_PAYMENT");
                } else { throw new Error("Bukti pembayaran wajib diunggah."); }
                
                submitButton.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Menyimpan data...';
                registrationData.status = "Belum Diperiksa";
                const randomQueueNumber = Math.floor(100 + Math.random() * 900);
                registrationData.queueNumber = `F-${randomQueueNumber}`;
                const newRegistrationRef = db.ref('pendaftaran').push();
                await newRegistrationRef.set(registrationData);
                
                confirmationModal.hide();
                document.getElementById('queue-number').textContent = registrationData.queueNumber;
                const formattedDate = new Date(registrationData.date).toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', timeZone: 'Asia/Jakarta' });
                document.getElementById('queue-schedule').textContent = `${formattedDate}, ${registrationData.time}`;
                showSection('success'); 
            } catch (error) { 
                console.error("Proses Pendaftaran Gagal Total: ", error); 
                alert(`Pendaftaran Gagal. ${error.message}. Mohon periksa kembali file atau koneksi Anda dan coba lagi.`);
            } finally { 
                submitButton.disabled = false; 
                submitButton.textContent = 'Konfirmasi & Daftar'; 
            }
        });
        
        document.getElementById('btn-download-ticket').addEventListener('click', () => {
            const { jsPDF } = window.jspdf; 
            const doc = new jsPDF();
            const formatDate = (dateStr, options) => new Date(dateStr).toLocaleDateString('id-ID', options);
            doc.setFontSize(18); doc.setFont("helvetica", "bold"); doc.text("Tiket Antrian - Klinik Patria", 105, 20, { align: "center" });
            doc.setLineWidth(0.5); doc.line(20, 25, 190, 25);
            doc.setFontSize(12); doc.setFont("helvetica", "bold"); doc.text("Nomor Antrian Anda:", 20, 40);
            doc.setFontSize(22); doc.setFont("helvetica", "bold"); doc.setTextColor(0, 86, 179); doc.text(registrationData.queueNumber, 20, 52);
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(11); doc.setFont("helvetica", "normal");
            
            const categoryMap = { 'disabilitas-sktm': 'Disabilitas (Dengan SKTM)', 'disabilitas-non-sktm': 'Disabilitas (Non-SKTM)', 'umum': 'Masyarakat Umum' };

            const addDataRow = (label, value, y) => { doc.setFont("helvetica", "bold"); doc.text(label, 20, y); doc.setFont("helvetica", "normal"); doc.text(value, 80, y, { maxWidth: 110 }); };
            addDataRow('Nama Pasien:', registrationData.fullName, 70);
            addDataRow('Jadwal Kunjungan:', `${formatDate(registrationData.date, { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}, ${registrationData.time}`, 80);
            addDataRow('Kategori:', categoryMap[registrationData.category], 90);
            addDataRow('Biaya:', `Rp ${new Intl.NumberFormat('id-ID').format(registrationData.price)}`, 100);
            addDataRow('Jenis Disabilitas:', registrationData.disabilityType || 'Tidak ada', 110);
            
            doc.setFont("helvetica", "bold"); doc.text("Keluhan:", 20, 120); doc.setFont("helvetica", "normal");
            const complaintLines = doc.splitTextToSize(registrationData.complaint, 110);
            doc.text(complaintLines, 80, 120);
            
            const finalY = 120 + (complaintLines.length * 5) + 10;
            doc.line(20, finalY, 190, finalY);
            doc.setFontSize(10); doc.text("Terima kasih. Mohon datang 15 menit sebelum jadwal Anda.", 105, finalY + 10, { align: "center" });
            doc.save(`Tiket_Antrian_${registrationData.queueNumber}.pdf`);
        });

        document.getElementById('btn-back-to-home').addEventListener('click', () => {
            document.getElementById('patient-form').reset();
            registrationData = {};
            showSection('landing'); 
        });
        
        // Memulai aplikasi
        checkLoginStatus();
        const savedUser = sessionStorage.getItem('loggedInUser');
        if (!savedUser) { 
            showSection('landing');
        } else {
            showSection('dashboard');
        }
    });
    </script>
</body>
</html>